{% extends "frame.html" %}
{% block mainwindow %}


<div class="row">
	<div class="col-sm-4">

<div class="panel panel-default">
  <div class="panel-heading" style="font-weight: bold">
	  <a href="/">Shed</a> / <a href="/detail/{{ detail_host }}">{{  detail_host }}</a> / {{ detail_version }}-{{detail_cluster}}
  </div>
  <div class="panel-body" ><!--
	  <iframe src="https://localhost/grafana/d-solo/5CGjHlRiz/postgresql-server-overview?refresh=1m&orgId=1&from=1536737683130&to=1536748483132&var-job=localhost&var-cluster=9.6%2Fdemo&var-host=All&var-datname=All&var-rate_interval=5m&var-disk=All&var-ntop_relations=5&var-interface=All&var-filesystem=All&var-application_name=All&theme=light&panelId=1" width="350" height="200" frameBorder="0"  style="float:right"></iframe>
	  <iframe src="https://localhost/grafana/d-solo/5CGjHlRiz/postgresql-server-overview?refresh=1m&orgId=1&from=1536738004168&to=1536748804170&var-job=localhost&var-cluster=9.6%2Fdemo&var-host=All&var-datname=All&var-rate_interval=5m&var-disk=All&var-ntop_relations=5&var-interface=All&var-filesystem=All&var-application_name=All&theme=light&panelId=32" width="450" height="200" frameborder="0" style="float: right"></iframe>-->
 <div class="btn-group">
 <button type="button" class="btn btn-primary state-disable-for-online" onclick="pg_start()">Start</button>
 <button type="button" class="btn btn-primary  state-disable-for-offline" onclick="pg_reload()">Reload</button>
 <button type="button" class="btn btn-primary state-disable-for-no-recovery state-disable-for-offline" >Promote</button>
 <button type="button" class="btn btn-primary state-disable-for-offline">Stop</button>
 <button type="button" class="btn btn-primary state-disable-for-online">Remove</button>
 </div>
 <br>State: 
 <span class="pg_state"style="font-size: 32px"></span><br>
  <span id="pg_log"></span>

  </div>

	
</div>

	</div>

	<div class="col-sm-8">

<div class="panel panel-default">
	<!--  <div class="panel-heading" style="font-weight: bold">Utilities</div>-->
  <div class="panel-body" >
 <div class="btn-group btn-group-justified">
	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Monitoring </button></div>
	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Administration</button></div>
	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Metriken </button></div>
 	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Reports </button></div>
	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Backups </button></div>
	 <div class="btn-group btn-group-justified"><button type="button" class="btn btn-primary"><img src="https://www.credativ.de/sites/credativ.de/files/images/Logo.png" style="height:40px"><br>Funk </button></div>

 </div>
 
  </div>

	
</div>

	</div>




	</div>

<div class="row">
	<div class="col-sm-6">
		<div class="panel panel-default">
		  <div class="panel-heading" style="font-weight: bold"> System-Information  </div>
		  <div class="panel-body" >
	  Host: {{ detail_host}}<br>
	  Cluster: <span class="pg_cluster"></span><br>
	  PG_Version: <span class="pg_version"></span><br>
	  data_dir: <span class="pg_pgdata"></span><br>
	  logfile: <span class="pg_logfile"></span><br>
	  system_start: <span class="pg_start"></span><br>
    <a href="#">Grafana</a> / <a href="#">pgAdmin4</a>
		  </div>
		</div>
	</div>
   <div class="col-sm-6">
	<div class="panel panel-default">
	  <div class="panel-heading" style="font-weight: bold">
	  Cluster-Configuration
	  </div>
  <div class="panel-body" >
	  Host: {{ detail_host}}<br>
	  Cluster: <span class="pg_cluster"></span><br>
	  PG_Version: <span class="pg_version"></span><br>
	  data_dir: <span class="pg_pgdata"></span><br>
	  logfile: <span class="pg_logfile"></span><br>
	  system_start: <span class="pg_start"></span><br>
    <a href="#">Grafana</a> / <a href="#">pgAdmin4</a>
  </div>
</div>



</div>


<script>

function log(msg){
	var l =  $('#pg_log');
	console.log(l);
	l.prepend('<div class="message">'+msg+'</div>');
}

function pg_start(){
log('Starting Instance...');
}
function pg_reload(){
log('Reloading Instance...');
	$.ajax({url: 'http://{{ detail_host }}:15432/cluster/{{ detail_version }}/{{ detail_cluster}}',
	method: 'patch',
	data: '{ "state": "reload" }',
	success: function(data){ log("Instance Reloaded..") },
	error: function(a,data){log("Could not Reload"); console.log(data);}
	});
}



function fill_details( details, host) {
	var runstate = '';
	if ( details['running'] == 1 ){
		runstate='online';
		$('.state-disable-for-online').prop('disabled',true);
	}
	else{ runstate='offline'	
		$('.state-disable-for-offline').prop('disabled',true);
	}
	if ( details['recovery'] == 1 ){
		runstate+=' in recovery';
		$('.state-disable-for-no-recovery').prop('disabled',true);
	}

	for ( var key in details){
		$('.pg_'+key).html( details[key]);
		//alert(key);
	};
	$('.hostname').html( host ) ;
	$('.pg_state').html( runstate);
	
}

function get_host( hosturl, clustername, clusterversion){

	 $.ajax({ url: 'http://'+hosturl+':15432/cluster/'+clusterversion+'/'+clustername,
		 success: function(result){ fill_details( result, hosturl )  },
		error: function(){ alert('BAD');},

	 });
	};

$(document).ready(function() {
	get_host( '{{ detail_host }}', '{{ detail_cluster }}', '{{ detail_version }}' ) ;
});

</script>
{% endblock %}
