- name: "pg_stat_user_tables"
  help: "Table stats"
  labels:
    - "datname"
    - "schemaname"
    - "relname"
  values:
    - "seq_scan"
    - "seq_tup_read"
    - "idx_scan"
    - "idx_tup_fetch"
    - "n_tup_ins"
    - "n_tup_upd"
    - "n_tup_del"
    - "n_tup_hot_upd"
    - "n_live_tup"
    - "n_dead_tup"
    - "vacuum_count"
    - "autovacuum_count"
    - "analyze_count"
    - "autoanalyze_count"
  query: |
          SELECT
            current_database()::text AS datname
          , coalesce(schemaname::text, 'null') AS schemaname
          , coalesce(relname::text, 'null') AS relname
          , coalesce(seq_scan,0)::float AS seq_scan
          , coalesce(seq_tup_read,0)::float AS seq_tup_read
          , coalesce(idx_scan,0)::float AS idx_scan
          , coalesce(idx_tup_fetch,0)::float AS idx_tup_fetch
          , coalesce(n_tup_ins,0)::float AS n_tup_ins
          , coalesce(n_tup_upd,0)::float AS n_tup_upd
          , coalesce(n_tup_del,0)::float AS n_tup_del
          , coalesce(n_tup_hot_upd,0)::float AS n_tup_hot_upd
          , coalesce(n_live_tup,0)::float AS n_live_tup
          , coalesce(n_dead_tup,0)::float AS n_dead_tup
          , coalesce(vacuum_count,0)::float AS vacuum_count
          , coalesce(autovacuum_count,0)::float AS autovacuum_count
          , coalesce(analyze_count,0)::float AS analyze_count
          , coalesce(autoanalyze_count,0)::float AS autoanalyze_count
          FROM pg_stat_user_tables FULL JOIN (VALUES(0)) filler(i) ON TRUE;

- name: "pg_statio_user_tables"
  help: "IO Stats"
  labels:
    - "datname"
    - "schemaname"
    - "relname"
  values:
    - "heap_blks_read"
    - "heap_blks_hit"
    - "idx_blks_read"
    - "idx_blks_hit"
  query: |
          SELECT
            current_database()::text AS datname
          , COALESCE(schemaname::text, 'null') AS schemaname
          , COALESCE(relname::text, 'null') AS relname
          , COALESCE(heap_blks_read::float,0) AS heap_blks_read
          , COALESCE(heap_blks_hit::float,0) AS heap_blks_hit
          , COALESCE(idx_blks_read::float,0) AS idx_blks_read
          , COALESCE(idx_blks_hit::float,0) AS idx_blks_hit
          FROM pg_statio_user_tables FULL JOIN (VALUES(0)) filler(i) ON TRUE;

- name: "BufferAccess"
  help: "Buffers Accessed"
  labels:
    - "datname"
    - "schemaname"
    - "relname"
  values:
    - "reads"
  query: |
          SELECT
          current_database()::text AS datname,
          COALESCE(schemaname::text, 'null') AS schemaname,
          COALESCE(relname::text, 'null') AS relname,
          sum( coalesce( heap_blks_read,0)
          + coalesce(heap_blks_hit,0)
          + coalesce(idx_blks_hit,0)
          + coalesce(idx_blks_read,0)
          + coalesce(toast_blks_hit,0)
          + coalesce(toast_blks_read,0)
          + coalesce(tidx_blks_hit,0)
          + coalesce(tidx_blks_read,0))*8196::bigint as reads
          FROM pg_statio_user_tables FULL JOIN (VALUES(0)) filler(i) ON TRUE
          GROUP BY 1,2,3;

- name: "Maintenancecounters"
  help: "Counters for maintenance jobs on user tables"
  labels:
    - "datname"
  values:
    - "vacuum_count"
    - "autovacuum_count"
    - "analyze_count"
    - "autoanalyze_count"
  query: |
          SELECT
          current_database()::text AS datname,
          sum( vacuum_count) vacuum_count,
          sum( autovacuum_count) autovacuum_count,
          sum( analyze_count) analyze_count,
          sum( autoanalyze_count) autoanalyze_count
          FROM pg_stat_all_tables;
